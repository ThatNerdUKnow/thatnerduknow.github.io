<!doctype html><html lang=en><head><title>I'm probably on a watchlist now :: Brandon Piña</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="At the beginning of this year I was itching to start a new project, and found one that sparked my interest. At the time I noticed online that there was interest around tracking the finances of politicians in the U.S. Senate and House of Representatives. The reason being that representatives and senators are privy to and influence economic policy which can and often do impact the stock market. This presents a conflict of interest on their part as at this point they can still participate in the stock market and may pass policies that impact their portfolio favorably."><meta name=keywords content="twitter"><meta name=robots content="noodp"><link rel=canonical href=https://thatnerduknow.github.io/posts/financial-disclosures/><link rel=stylesheet href=https://thatnerduknow.github.io/assets/style.css><link rel=stylesheet href=https://thatnerduknow.github.io/assets/green.css><link rel=apple-touch-icon href=https://thatnerduknow.github.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://thatnerduknow.github.io/img/favicon/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="I'm probably on a watchlist now"><meta property="og:description" content="At the beginning of this year I was itching to start a new project, and found one that sparked my interest. At the time I noticed online that there was interest around tracking the finances of politicians in the U.S. Senate and House of Representatives. The reason being that representatives and senators are privy to and influence economic policy which can and often do impact the stock market. This presents a conflict of interest on their part as at this point they can still participate in the stock market and may pass policies that impact their portfolio favorably."><meta property="og:url" content="https://thatnerduknow.github.io/posts/financial-disclosures/"><meta property="og:site_name" content="Brandon Piña"><meta property="og:image" content="https://thatnerduknow.github.io/img/favicon/green.png"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2022-08-27 22:23:33 -0500 -0500"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://thatnerduknow.github.io/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/tags/>Tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/tags/>Tags</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://thatnerduknow.github.io/posts/financial-disclosures/>I&rsquo;m probably on a watchlist now</a></h1><div class=post-meta><span class=post-date>2022-08-27
[Updated: 2022-08-27]</span>
<span class=post-author>:: Brandon Piña</span>
<span class=post-reading-time>:: 7 min read (1314 words)</span></div><span class=post-tags>#<a href=https://thatnerduknow.github.io/tags/project/>project</a>&nbsp;
#<a href=https://thatnerduknow.github.io/tags/programming/>programming</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#thanks-obama><em>Thanks, Obama</em></a></li><li><a href=#this-is-where-the-magick-happens>This is where the Magick happens</a></li><li><a href=#posting-to-twitter>Posting to Twitter</a></li><li><a href=#deployment>Deployment</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#tldr>TLDR:</a></li></ul></nav></div><div class=post-content><div><p>At the beginning of this year I was itching to start a new project, and found one that sparked my interest. At the time I noticed online that there was interest around tracking the finances of politicians in the U.S. Senate and House of Representatives. The reason being that representatives and senators are privy to and influence economic policy which can and often do impact the stock market. This presents a conflict of interest on their part as at this point they can still participate in the stock market and may pass policies that impact their portfolio favorably. As a result, <a href=https://prospect.org/power/congress-beats-wall-street-at-its-own-game/>concern of insider trading in congress has been growing in recent years</a>. Tracking politicians&rsquo; finances isn&rsquo;t a new idea, (see the Nancy Pelosi ETF). It seems however, that previous trackers have been focused on specific members. This is why I presume <strong>@PelosiTracker</strong> was banned from twitter. I decided to track all congress&rsquo; financial disclosures. But where would I get the data?</p><blockquote><p>On April 4, 2012, President Obama signed into law the Stop Trading on Congressional Knowledge Act of 2012, Pub. L. No. 112-105 (2012) (STOCK Act). Section 6 of the STOCK Act adds new subsection 103(l) to the Ethics in Government Act of 1978, 5 U.S.C. app. 4, § 101 et seq. (EIGA). Effective July 3, 2012, subsection 103(l) of EIGA requires that not later than 30 days after receiving notification of any transaction required to be reported under subsection 102(a)(5)(B) of EIGA, but in no case later than 45 days after such a transaction, a covered employee must file a report of the transaction.</p></blockquote><h2 id=thanks-obama><em>Thanks, Obama</em><a href=#thanks-obama class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The idea of the STOCK act and EIGA is to keep Congress honest. That&rsquo;s the idea at least. Financial disclosure data is available from the <a href=https://disclosures-clerk.house.gov/PublicDisclosure/FinancialDisclosure>House Clerk</a> and the <a href=https://efdsearch.senate.gov/search/home/>Senate Clerk</a> websites. The problem remains on how to get the data from these sites. I used a library called puppeteer to control a headless chromium web browser to scrape the documents from the house disclosure site. This gave me metadata such as Name, Date and Report type as well as a url where I could download a PDF of the submitted report. Now that I have the PDF File, How am I going to post it to twitter? As of now, there is no way to post a PDF as an attachment to a tweet. I need to convert it to JPEG files</p><h2 id=this-is-where-the-magick-happens>This is where the Magick happens<a href=#this-is-where-the-magick-happens class=hanchor arialabel=Anchor>&#8983;</a></h2><p>There is a FOSS tool out there called ImageMagick that can convert images between formats and even do some processing as well. The conversion feature suits my needs perfectly fine. Importantly, we can control it using a library. I found a library with bindings for node unsurprisingly called <em>imagemagick</em> and I started merrily converting away. To tell the truth there&rsquo;s not much to say here, despite the fact that without this specific component, this project would have never shipped.</p><h2 id=posting-to-twitter>Posting to Twitter<a href=#posting-to-twitter class=hanchor arialabel=Anchor>&#8983;</a></h2><p>To get an API key for Twitter, you need to submit an application and furthermore to get write access (which I need to post tweets) I need to submit yet another application. I managed to get write access easily enough, but at first my write access application was denied for reasons unknown. I appealed the decision and managed to get the access I needed to start tweeting.</p><h2 id=deployment>Deployment<a href=#deployment class=hanchor arialabel=Anchor>&#8983;</a></h2><p>In a monster fueled fever dream, I managed to get a proof of concept up and running in the space of 24 hours, but there was still the matter of deploying the bot. I was having issues docker-izing the bot as it required dependencies outside the npm ecosystem</p><p>Here&rsquo;s the dockerfile I ended up with</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> node:16-bullseye-slim</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /usr/src/app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> . .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Set imagemagick&#39;s cache directory to our mount point so that we don&#39;t bloat our docker storage</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> MAGICK_TMPDIR /usr/src/app/config/cache<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Do stuff that puppeteer requires for some reason</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> apt-get install -y wget gnupg <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | apt-key add - <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> sh -c <span style=color:#e6db74>&#39;echo &#34;deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main&#34; &gt;&gt; /etc/apt/sources.list.d/google.list&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> apt-get update <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> apt-get install -y google-chrome-stable fonts-ipafont-gothic fonts-wqy-zenhei fonts-thai-tlwg fonts-kacst fonts-freefont-ttf libxss1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --no-install-recommends <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Insall other deps</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y imagemagick ghostscript<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Edit ImageMagick PDF Policy for read/write access</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> sed -i_bak <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>&#39;s/rights=&#34;none&#34; pattern=&#34;PDF&#34;/rights=&#34;read | write&#34; pattern=&#34;PDF&#34;/&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>/etc/ImageMagick-6/policy.xml<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Edit ImageMagick policy for a bigger disk cache</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> sed -i <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>&#39;s/domain=&#34;resource&#34; name=&#34;disk&#34; value=&#34;1GiB&#34;/ domain=&#34;resource&#34; name=&#34;disk&#34; value=&#34;10GiB&#34;/&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>/etc/ImageMagick-6/policy.xml<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Limit each instance&#39;s thread count to 1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> sed -i <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>&#39;s/domain=&#34;resource&#34; name=&#34;thread&#34; value=&#34;2&#34;/ domain=&#34;resource&#34; name=&#34;thread&#34; value=&#34;1&#34;/&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>/etc/ImageMagick-6/policy.xml<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Give imagemagick more memory</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> sed -i <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#e6db74>&#39;s/domain=&#34;resource&#34; name=&#34;memory&#34; value=&#34;256MiB&#34;/ domain=&#34;resource&#34; name=&#34;memory&#34; value=&#34;2GiB&#34;/&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>/etc/ImageMagick-6/policy.xml<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Install nodejs dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> npm ci<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Run app as node</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e>#USER node</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir config<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir config/img<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir config/pdf<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir config/cache<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;node&#34;</span>,<span style=color:#e6db74>&#34;index.js&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>As you can see, the dockerfile I ended up with is substantial. Some of the issues I had to contend with were:</p><ul><li>Apt Couldn&rsquo;t find my dependencies in the apt repository<ul><li>This was solved by prepending <code>apt-get install</code> commands with <code>apt-get update</code></li></ul></li><li>Imagemagick requires ghostscript as a dependency</li><li>puppeteer&rsquo;s chromium installation couldn&rsquo;t launch<ul><li>After scouring stackoverflow I found that my docker image was missing necessary resources for chrome to run, like fonts. I ended up installing google chrome via apt to resolve chromium&rsquo;s dependency issues</li></ul></li><li>Imagemagick didn&rsquo;t have permission to read the filesystem<ul><li>I had to use the <code>sed</code> command to edit imagemagick&rsquo;s <code>policy.xml</code> to allow it to access to the filesystem so that it could convert pdfs</li></ul></li><li>Imagemagick uses the filesystem as a cache. This is a problem as if you don&rsquo;t mount imagemagick&rsquo;s cache directory to a docker volume, your <code>docker.img</code> size will bloat as pdfs are and converted<ul><li>Imagemagick conveniently allows you to configure it&rsquo;s cache directory using the environment variable <code>MAGICK_TMPDIR</code></li></ul></li></ul><h2 id=conclusion>Conclusion<a href=#conclusion class=hanchor arialabel=Anchor>&#8983;</a></h2><p>I&rsquo;m pretty happy with the result I ended up with. I learned a lot about web scraping and more complicated deployments with docker. I had a few regrets after I was done though. For one, I only ended up scraping data from the house clerk site, as at the time I made the false assumption that the house clerk served both senate and house disclosures. Secondly, I threw this project together using plain javascript, with no framework or typescript. The lack of typescript is probably what ended up hurting me the most because when I went back to add support for senate disclosures, I had to try to remember what data lived in my variables and typescript would have made my life much simpler. I&rsquo;m currently in the process of rewriting this project using <code>NestJS</code> which is a framework inspired by angular which makes managing the organization of your code much easier. I can separate out the concerns of components of my project by domain into modules which give me a warm fuzzy feeling inside. Some other improvements I could have made were to first check if an API exists to gather this information before bothering with web scraping, but I was in such a hurry to see it working so I failed to do so. I&rsquo;m currently having issues scraping the Senate Clerk site so that might be the push I need to go that route.</p><h2 id=tldr>TLDR:<a href=#tldr class=hanchor arialabel=Anchor>&#8983;</a></h2><p>I wrote a twitter bot that tracks congressional financial disclosures</p><ul><li>Lessons Learned<ul><li>Before resorting to web scraping, check if an API already exists</li><li>Typescript is your best friend when you revisit your project a few months after deployment</li><li>When starting a project, think about organization. Would you benefit from using a framework?</li><li>Deployment is sometimes harder than development</li></ul></li></ul><p>The bot is currently hosted on a Dell R710 that lives under my bed. You can see the bot at <a href=https://twitter.com/congressionalfd>@CongressionalFD</a>, and you can look at the source code <a href=https://github.com/ThatNerdUKnow/Financial-Disclosures>here</a></p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://thatnerduknow.github.io/posts/typescript-is-magic/><span class=button__icon>←</span>
<span class=button__text>Typescript Is Magic</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://thatnerduknow.github.io/assets/main.js></script>
<script src=https://thatnerduknow.github.io/assets/prism.js></script></div></body></html>