<!doctype html><html lang=en><head><title>Typescript Is Magic :: Brandon Piña</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Using *Intersection Types* and *Template Literals* in a record type allows us to derive an object's type based off of it's key. This is especially useful when you don't know how many keys may exist on this object at build time with the caveat that the keys must follow a predictable pattern"><meta name=keywords content="typescript"><meta name=robots content="noodp"><link rel=canonical href=https://thatnerduknow.github.io/posts/typescript-is-magic/><link rel=stylesheet href=https://thatnerduknow.github.io/assets/style.css><link rel=stylesheet href=https://thatnerduknow.github.io/assets/green.css><link rel=apple-touch-icon href=https://thatnerduknow.github.io/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=https://thatnerduknow.github.io/img/favicon/green.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Typescript Is Magic"><meta property="og:description" content="Using *Intersection Types* and *Template Literals* in a record type allows us to derive an object's type based off of it's key. This is especially useful when you don't know how many keys may exist on this object at build time with the caveat that the keys must follow a predictable pattern"><meta property="og:url" content="https://thatnerduknow.github.io/posts/typescript-is-magic/"><meta property="og:site_name" content="Brandon Piña"><meta property="og:image" content="https://thatnerduknow.github.io/"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:published_time" content="2022-08-31 17:26:00 -0500 -0500"></head><body class=green><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=https://thatnerduknow.github.io/><div class=logo>Terminal</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/tags/>Tags</a></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/tags/>Tags</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=https://thatnerduknow.github.io/posts/typescript-is-magic/>Typescript Is Magic</a></h1><div class=post-meta><span class=post-date>2022-08-31
[Updated: 2022-08-31]</span>
<span class=post-author>:: Brandon Piña</span>
<span class=post-reading-time>:: 3 min read (512 words)</span></div><span class=post-tags>#<a href=https://thatnerduknow.github.io/tags/programming/>programming</a>&nbsp;
#<a href=https://thatnerduknow.github.io/tags/typescript/>typescript</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#the-problem>The problem</a></li><li><a href=#okay-so-what>Okay, so what?</a></li><li><a href=#tldr>TLDR</a></li></ul></nav></div><div class=post-content><div><p>Typescript somehow always manages to find new and exciting ways to surprise me. It&rsquo;s no secret that investing time in defining good types for your projects is well worth it as you get better intellisense and lower cognitive load when dealing with your custom types. (<em>What properties exist on this object again?</em>) However, sometimes it can be difficult to define a type for an upstream service, like an API. If you know what keys/types to expect beforehand you might define your types as such:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>APIResponse</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>: <span style=color:#66d9ef>APIData</span> <span style=color:#f92672>|</span> <span style=color:#a6e22e>APIError</span>; <span style=color:#75715e>// Data returned by the api could be valid or not
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>headers</span>: <span style=color:#66d9ef>Record</span>&lt;<span style=color:#f92672>string</span><span style=color:#960050;background-color:#1e0010>,</span> <span style=color:#a6e22e>string</span>&gt;;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timestamp</span>: <span style=color:#66d9ef>Date</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>motd</span>: <span style=color:#66d9ef>string</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Therefore we need to know what properties to expect
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>APIData</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>foo</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;bar&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>APIError</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;You done goofed&#39;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=the-problem>The problem<a href=#the-problem class=hanchor arialabel=Anchor>&#8983;</a></h2><p>But what if you don&rsquo;t know what keys exist at build time? Like in the case an api batch endpoint or a configuration file? What if certain key patterns map to certain types? Enter <em><strong>Template Literals</strong></em> and <em><strong>Intersection types</strong></em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#75715e>// Define individual record types with a key matching a pattern 
</span></span></span><span style=display:flex><span><span style=color:#75715e>// defined by a template literal and the corresponding type
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>stringRecord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Record</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>`String</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>number</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,<span style=color:#66d9ef>string</span><span style=color:#f92672>&gt;</span> <span style=color:#75715e>// Properties with keys matching &#34;String${number}&#34; will be of type string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>numberRecord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>Record</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>`Number</span><span style=color:#e6db74>${</span><span style=color:#66d9ef>number</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,<span style=color:#66d9ef>number</span><span style=color:#f92672>&gt;</span> <span style=color:#75715e>// Properties with keys matching &#34;Number${number}&#34; will be of type number
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// An intersection type rather than a union type is necessary
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Because the record types need to coexist
</span></span></span><span style=display:flex><span><span style=color:#75715e>// rather than being of one type or the other
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>intersectionRecord</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>stringRecord</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>numberRecord</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>foo</span>: <span style=color:#66d9ef>intersectionRecord</span> <span style=color:#f92672>=</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`String</span><span style=color:#e6db74>${</span><span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Bar&#34;</span> <span style=color:#75715e>// Valid
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`Number</span><span style=color:#e6db74>${</span><span style=color:#ae81ff>1</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e>// Also Valid
</span></span></span></code></pre></div><p>Here&rsquo;s where things get interesting. <em>Typescript can warn us of invalid uses of our type</em> on both our keys and values of the record.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#75715e>// Invalid assignment to valid key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`Number</span><span style=color:#e6db74>${</span><span style=color:#ae81ff>2</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Baz&#34;</span> <span style=color:#75715e>// Type &#39;string&#39; is not assignable to type &#39;number&#39;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`String</span><span style=color:#e6db74>${</span><span style=color:#ae81ff>2</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#75715e>// Type &#39;number&#39; is not assignable to type &#39;string&#39;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Assignment to invalid key
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`NumberA`</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#75715e>// Property &#39;NumberA&#39; does not exist on type &#39;intersectionRecord&#39;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`StringA`</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Foo&#34;</span> <span style=color:#75715e>//  Property &#39;StringA&#39; does not exist on type &#39;intersectionRecord&#39;.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>foo</span>[<span style=color:#e6db74>`Invalid Key`</span>] <span style=color:#75715e>//  Property &#39;Invalid Key&#39; does not exist on type &#39;intersectionRecord&#39;.
</span></span></span></code></pre></div><h2 id=okay-so-what>Okay, so what?<a href=#okay-so-what class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Imagine if you will our api provides us a batch endpoint which we may make multiple requests and make subsequent requests based on other requests in the batch. We may request different <em><strong>types</strong></em> of resources and a single union type record: <code>Record&lt;string, ResourceA|ResourceB|etc.></code> type may not be suitable for our needs. If we can derive the type we expect from the <em><strong>key</strong></em> of the object instead of using a union type record, we can provide an extra level of type safety!</p><h2 id=tldr>TLDR<a href=#tldr class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Using <em>Intersection Types</em> and <em>Template Literals</em> in a record type allows us to derive an object&rsquo;s type based off of it&rsquo;s key. This is especially useful when you don&rsquo;t know how many keys may exist on this object at build time with the caveat that the keys must follow a predictable pattern</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://thatnerduknow.github.io/posts/enigma-machine/><span class=button__icon>←</span>
<span class=button__text>Making an Enigma Machine</span></a></span>
<span class="button next"><a href=https://thatnerduknow.github.io/posts/financial-disclosures/><span class=button__text>I'm probably on a watchlist now</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=https://thatnerduknow.github.io/assets/main.js></script>
<script src=https://thatnerduknow.github.io/assets/prism.js></script></div></body></html>